<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Hello MT-BLOG</title>
    <meta name="description" content="12345，上山打老虎。">
    
    
    <link rel="preload" href="/mt-blog/assets/css/0.styles.baa7dbc8.css" as="style"><link rel="preload" href="/mt-blog/assets/js/app.88e9b856.js" as="script"><link rel="preload" href="/mt-blog/assets/js/9.3002f458.js" as="script"><link rel="prefetch" href="/mt-blog/assets/js/6.5c6b8eaa.js"><link rel="prefetch" href="/mt-blog/assets/js/1.629df6b3.js"><link rel="prefetch" href="/mt-blog/assets/js/2.fa728287.js"><link rel="prefetch" href="/mt-blog/assets/js/3.92c74be8.js"><link rel="prefetch" href="/mt-blog/assets/js/4.7b668fe3.js"><link rel="prefetch" href="/mt-blog/assets/js/5.aedf3fc8.js"><link rel="prefetch" href="/mt-blog/assets/js/7.05cea6eb.js"><link rel="prefetch" href="/mt-blog/assets/js/8.84744332.js"><link rel="prefetch" href="/mt-blog/assets/js/10.10f66d6c.js"><link rel="prefetch" href="/mt-blog/assets/js/11.bddcec58.js"><link rel="prefetch" href="/mt-blog/assets/js/12.e80af53f.js"><link rel="prefetch" href="/mt-blog/assets/js/13.623cc8c3.js">
    <link rel="stylesheet" href="/mt-blog/assets/css/0.styles.baa7dbc8.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="page-main"><div class="component-nav-menu"><div class="placeholder"></div><div class="search-wrapper"><div aria-haspopup="listbox" role="combobox" aria-owns="el-autocomplete-1742" background-color="#eee" class="el-autocomplete"><div class="el-input el-input--prefix"><!----><input type="text" autocomplete="off" valueKey="title" placeholder="请输入内容" fetchSuggestions="function () { [native code] }" triggerOnFocus="true" debounce="300" placement="bottom-start" value="" class="el-input__inner"><span class="el-input__prefix"><i class="el-input__icon el-icon-search"></i></span><!----><!----></div><div role="region" class="el-autocomplete-suggestion el-popper" style="width:;display:none;"><div class="el-scrollbar"><div class="el-autocomplete-suggestion__wrap el-scrollbar__wrap el-scrollbar__wrap--hidden-default"><ul class="el-scrollbar__view el-autocomplete-suggestion__list"></ul></div><div class="el-scrollbar__bar is-horizontal"><div class="el-scrollbar__thumb" style="width:0;transform:translateX(0%);ms-transform:translateX(0%);webkit-transform:translateX(0%);"></div></div><div class="el-scrollbar__bar is-vertical"><div class="el-scrollbar__thumb" style="height:0;transform:translateY(0%);ms-transform:translateY(0%);webkit-transform:translateY(0%);"></div></div></div></div></div></div><ul role="menubar" class="el-menu--horizontal el-menu" style="background-color:;"><li role="menuitem" tabindex="-1" class="el-menu-item" style="color:;border-bottom-color:transparent;background-color:;">
        Home
      </li><li role="menuitem" tabindex="-1" class="el-menu-item is-active" style="color:;border-bottom-color:;background-color:;">
        Blog
      </li><li role="menuitem" tabindex="-1" class="el-menu-item" style="color:;border-bottom-color:transparent;background-color:;">
        关于我
      </li><li role="menuitem" aria-haspopup="true" class="el-submenu"><div class="el-submenu__title" style="border-bottom-color:transparent;color:;background-color:;">
          我的项目
        <i class="el-submenu__icon-arrow el-icon-arrow-down"></i></div><div class="el-menu--horizontal" style="display:none;"><ul role="menu" class="el-menu el-menu--popup el-menu--popup-" style="background-color:;"><li role="menuitem" tabindex="-1" class="el-menu-item" style="color:;background-color:;">
          focus-outside
        </li><li role="menuitem" tabindex="-1" class="el-menu-item" style="color:;background-color:;">
          stylus-converter
        </li></ul></div></li></ul></div><div class="page-container"><div class="component-page"><div class="page-content"><!----><div class="content custom"><h1 align="center">如何优雅解决 Iframe 无法触发 clickOutside</h1><h3 id="前言"><a href="#前言" aria-hidden="true" class="header-anchor">#</a> 前言</h3><blockquote><p>在公司的一次小组分享会上，<a href="https://github.com/coolzjy" target="_blank" rel="noopener noreferrer">组长<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 给我们分享了一个他在项目中遇到的一个问题。在一个嵌入 Iframe 的系统中，当我们点击 Dropdown 展开后，再去点击 Iframe 发现无法触发 Dropdown 的 clickOutside 事件，导致 Dropdown 无法收起。<a href="https://jsfiddle.net/_MT_/wLkgu614/29/" target="_blank" rel="noopener noreferrer">查看示例<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></blockquote><h3 id="为什么无法触发-clickoutside"><a href="#为什么无法触发-clickoutside" aria-hidden="true" class="header-anchor">#</a> 为什么无法触发 clickOutside</h3><p>因为大多数的 UI 组件库，例如 Element、ant-design、Iview 等都是通过鼠标事件来处理， 下面这段是 Iview 中的 clickOutside 代码，Iview 直接给 Document 绑定了 click 事件，当 click 事件触发时候，判断点击目标是否包含在绑定元素中，如果不是就调用绑定的函数。</p><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">bind</span> <span class="token punctuation">(</span>el<span class="token punctuation">,</span> binding<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">function</span> <span class="token function">documentHandler</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>el<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>binding<span class="token punctuation">.</span>expression<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          binding<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  el<span class="token punctuation">.</span>__vueClickOutside__ <span class="token operator">=</span> documentHandler<span class="token punctuation">;</span>
  document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> documentHandler<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>但 Iframe 中加载的是一个相对独立的 Document，如果直接在父页面中给 Document 绑定 click 事件，点击 Iframe 并不会触发该事件。</p><p>知道问题出现在哪里，接下来我们来思考怎么解决？</p><h4 id="给-iframe-的-body-元素绑定事件"><a href="#给-iframe-的-body-元素绑定事件" aria-hidden="true" class="header-anchor">#</a> 给 Iframe 的 body 元素绑定事件</h4><p>我们可以通过一些特殊的方式给 Iframe 绑定上事件，但这种做法不优雅，而且也是存在问题的。我们来想想一下这样一个场景，左边是一个侧边栏(导航栏)，上面是一个 Header 里面有一些 Dropdown 或是 Select 组件，下面是一个页面区域。但这些页面有的是嵌入 Iframe，有些是当前系统的页面。如果使用这种方法，我们在切换路由的时候就要不断的去判断这个页面是否包含 Iframe，然后绑定/解绑事件。但如果 Iframe 和当前系统不是同域，那么这种做法是无效的。</p><h4 id="添加遮罩层"><a href="#添加遮罩层" aria-hidden="true" class="header-anchor">#</a> 添加遮罩层</h4><p>我们可以通过给 Iframe 添加一个透明遮罩层，点击 Dropdown 的时候显示透明遮罩层，点击 Dropdown 之外的区域或遮罩层，就关闭遮罩层并派发 clickOutside 事件，这样虽然可以触发 clickOutside 事件，但存在一个问题，如果用户点击的区域正好是 Iframe 页面中的某个按钮，那么第一次点击是不会生效的，这种做法对于交互不是很友好。</p><h4 id="通过-focusin-与-focusout-事件"><a href="#通过-focusin-与-focusout-事件" aria-hidden="true" class="header-anchor">#</a> 通过 focusin 与 focusout 事件</h4><p>其实我们可以换一种思路，为什么一定要用鼠标事件呢？focusin 与 focusout 事件就很适合处理当前这种情况，当我们点击非绑定的元素时触发 focusout 事件，如果是就添加一个定时器，延时调用我们绑定的函数。当我们点击绑定元素例如 Dropdown 会触发 focusin 事件，这时候我们判断目标是否包含在绑定元素中，如果包含在绑定元素中就清除定时器。</p><p>不过使用 focusin 与 focusout 事件需要解决一个问题，那就是要将绑定的元素变成 focusable，那么怎么将元素变成focusable 呢？通过将 tabindex 属性置为 <code>-1</code> , 该元素就变成可由代码获取焦点。需要注意的是，元素变成 focusable 后，当它获取焦点浏览器会给它加上高亮样式，如果不需要这种样式可以将 outli 设置为 none。</p><p>不过这种方法虽然很棒，但是也存在一些问题，浏览器兼容性，下面是 MDN 给出的浏览器兼容情况，Firefox 低版本不兼容。</p><p><img src="WX20180621-175744.png" alt="WX20180621-175744"></p><h3 id="使用-focus-outside-库"><a href="#使用-focus-outside-库" aria-hidden="true" class="header-anchor">#</a> 使用 focus-outside 库</h3><p><a href="https://github.com/txs1992/focus-outside" target="_blank" rel="noopener noreferrer">focus-outside<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 是我为了解决上述问题所创建的仓库。使用起来也非常方便，它只有两个方法，bind 与 unbind，它不依赖任何其他库，并且支持为多个元素绑定一个函数。</p><p>为什么要给多个元素绑定一个函数，这么做是为了兼容 Element，因为 Element 的 Dropdown 会被插入 body 元素中，它的按钮和容器是分离的，当我们点击按钮显示 Dropdown，当我们点击 Dropdown 区域，这时候按钮会失去焦点触发 focusout 事件。事实上我们并不希望这时关闭 Dropdown，所以我将它们视为同一个绑定源。</p><p>这里说明下 Element 为什么要将弹出层放在 body 中，如果直接挂在父元素下，会受到父元素样式的影响。比如父元素有 overflow: hidden，弹出菜单就有可能被隐藏掉。</p><h4 id="简单使用"><a href="#简单使用" aria-hidden="true" class="header-anchor">#</a> 简单使用</h4><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// import { bind, unbidn } from 'focus-outside'</span>
<span class="token comment">// 建议使用下面这种别名，防止和你的函数命名冲突了。</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> bind<span class="token punctuation">:</span> focusBind<span class="token punctuation">,</span> unbind<span class="token punctuation">:</span> focusUnbind <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'focus-outside'</span>

<span class="token comment">// 如果你是使用 CDN 引入的，应该这么引入</span>
<span class="token comment">// &lt;script src=&quot;https://unpkg.com/focus-outside@0.4.0/lib/index.js&quot;&gt;&lt;/script&gt;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> bind<span class="token punctuation">:</span> focusBind<span class="token punctuation">,</span> unbind<span class="token punctuation">:</span> focusUnbind <span class="token punctuation">}</span> <span class="token operator">=</span> FocusOutside

<span class="token keyword">const</span> elm <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#dorpdown-button'</span><span class="token punctuation">)</span>
<span class="token comment">// 绑定函数</span>
<span class="token function">focusBind</span><span class="token punctuation">(</span>elm<span class="token punctuation">,</span> callback<span class="token punctuation">)</span>

<span class="token keyword">function</span> <span class="token function">callback</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'您点击了 dropdown 按钮外面的区域'</span><span class="token punctuation">)</span>
  <span class="token comment">// 清除绑定</span>
  <span class="token function">focusUnbind</span><span class="token punctuation">(</span>elm<span class="token punctuation">,</span> callback<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p><a href="https://jsfiddle.net/_MT_/z0dejc23/9/" target="_blank" rel="noopener noreferrer">查看在线示例<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p><h4 id="注意"><a href="#注意" aria-hidden="true" class="header-anchor">#</a> 注意</h4><p>前面说到过元素变成 focusable 后，当它获取焦点浏览器会给它加上高亮样式，如果你不希望看到和这个样式，你只需要将这个元素的 CSS 属性 outline 设置为 none。focsout-outside 0.5 的版本新增 className 参数，为每个绑定的元素添加类名，默认类名是 focus-outside，执行 unbind 函数时候会将这个类名从元素上删除 。</p><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">&quot;focus-ele&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>

<span class="token comment">// js</span>
<span class="token keyword">const</span> elm <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#focus-ele'</span><span class="token punctuation">)</span>
<span class="token comment">// 默认类名是 focus-outside</span>
<span class="token function">focusBind</span><span class="token punctuation">(</span>elm<span class="token punctuation">,</span> callback<span class="token punctuation">,</span> <span class="token string">'my-focus-name'</span><span class="token punctuation">)</span>

<span class="token comment">// css</span>
<span class="token comment">// 如果你需要覆盖所有的默认样式，可以在这段代码放在全局 CSS 中。</span>
<span class="token punctuation">.</span>my<span class="token operator">-</span>focus<span class="token operator">-</span>name <span class="token punctuation">{</span>
  outline<span class="token punctuation">:</span> none<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="在-vue-中使用"><a href="#在-vue-中使用" aria-hidden="true" class="header-anchor">#</a> 在 Vue 中使用</h4><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// outside.js</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    <span class="token function">bind</span> <span class="token punctuation">(</span>el<span class="token punctuation">,</span> binding<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">focusBind</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> binding<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token function">unbind</span> <span class="token punctuation">(</span>el<span class="token punctuation">,</span> binding<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">focusUnbind</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> binding<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// xx.vue</span>
<span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>div v<span class="token operator">-</span>outside<span class="token operator">=</span><span class="token string">&quot;handleOutside&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>

<span class="token keyword">import</span> outside <span class="token keyword">from</span> <span class="token string">'./outside.js'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    directives<span class="token punctuation">:</span> <span class="token punctuation">{</span> outside <span class="token punctuation">}</span><span class="token punctuation">,</span>

  methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token function">handleOutside</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 做点什么...</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><a href="https://jsfiddle.net/_MT_/57Lmbpe9/" target="_blank" rel="noopener noreferrer">查看在线示例<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p><h4 id="在-element-中使用"><a href="#在-element-中使用" aria-hidden="true" class="header-anchor">#</a> 在 Element 中使用</h4><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token operator">&lt;</span>el<span class="token operator">-</span>dropdown
    ref<span class="token operator">=</span><span class="token string">&quot;dropdown&quot;</span>
    trigger<span class="token operator">=</span><span class="token string">&quot;click&quot;</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>span <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;el-dropdown-link&quot;</span><span class="token operator">&gt;</span>
      下拉菜单<span class="token operator">&lt;</span>i <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;el-icon-arrow-down el-icon--right&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>i<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>el<span class="token operator">-</span>dropdown<span class="token operator">-</span>menu
    ref<span class="token operator">=</span><span class="token string">&quot;dropdownContent&quot;</span>
    slot<span class="token operator">=</span><span class="token string">&quot;dropdown&quot;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>el<span class="token operator">-</span>dropdown<span class="token operator">-</span>item<span class="token operator">&gt;</span>黄金糕<span class="token operator">&lt;</span><span class="token operator">/</span>el<span class="token operator">-</span>dropdown<span class="token operator">-</span>item<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>el<span class="token operator">-</span>dropdown<span class="token operator">-</span>item<span class="token operator">&gt;</span>狮子头<span class="token operator">&lt;</span><span class="token operator">/</span>el<span class="token operator">-</span>dropdown<span class="token operator">-</span>item<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>el<span class="token operator">-</span>dropdown<span class="token operator">-</span>item<span class="token operator">&gt;</span>螺蛳粉<span class="token operator">&lt;</span><span class="token operator">/</span>el<span class="token operator">-</span>dropdown<span class="token operator">-</span>item<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>el<span class="token operator">-</span>dropdown<span class="token operator">-</span>item<span class="token operator">&gt;</span>双皮奶<span class="token operator">&lt;</span><span class="token operator">/</span>el<span class="token operator">-</span>dropdown<span class="token operator">-</span>item<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>el<span class="token operator">-</span>dropdown<span class="token operator">-</span>item<span class="token operator">&gt;</span>蚵仔煎<span class="token operator">&lt;</span><span class="token operator">/</span>el<span class="token operator">-</span>dropdown<span class="token operator">-</span>item<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>el<span class="token operator">-</span>dropdown<span class="token operator">-</span>menu<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>el<span class="token operator">-</span>dropdown<span class="token operator">&gt;</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> bind<span class="token punctuation">:</span> focusBind<span class="token punctuation">,</span> unbind<span class="token punctuation">:</span> focusUnbind <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'focus-outside'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token function">mounted</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">focusBind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>dropdown<span class="token punctuation">.</span>$el<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>dropdown<span class="token punctuation">.</span>hide<span class="token punctuation">)</span>
    <span class="token function">focusBind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>dropdownContent<span class="token punctuation">.</span>$el<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>dropdown<span class="token punctuation">.</span>hide<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token function">destoryed</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">ocusUnbind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>dropdown<span class="token punctuation">.</span>$el<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>dropdown<span class="token punctuation">.</span>hide<span class="token punctuation">)</span>
    <span class="token function">focusUnbind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>dropdownContent<span class="token punctuation">.</span>$el<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>dropdown<span class="token punctuation">.</span>hide<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><a href="https://jsfiddle.net/_MT_/1wb8nk67/57/" target="_blank" rel="noopener noreferrer">查看在线示例<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p><h4 id="在-ant-design-中使用"><a href="#在-ant-design-中使用" aria-hidden="true" class="header-anchor">#</a> 在 ant-design 中使用</h4><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> Menu<span class="token punctuation">,</span> Dropdown<span class="token punctuation">,</span> Icon<span class="token punctuation">,</span> Button <span class="token punctuation">}</span> <span class="token operator">=</span> antd
<span class="token keyword">const</span> <span class="token punctuation">{</span> bind<span class="token punctuation">:</span> focusBind<span class="token punctuation">,</span> unbind<span class="token punctuation">:</span> focusUnbind <span class="token punctuation">}</span> <span class="token operator">=</span> FocusOutside

<span class="token keyword">function</span> <span class="token function">getItems</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>item <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>Menu<span class="token punctuation">.</span>Item key<span class="token operator">=</span><span class="token punctuation">{</span>item<span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token punctuation">{</span>item<span class="token punctuation">}</span> st menu item <span class="token operator">&lt;</span><span class="token operator">/</span>Menu<span class="token punctuation">.</span>Item<span class="token operator">&gt;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">MyMenu</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span> <span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>menuElm <span class="token operator">=</span> <span class="token keyword">null</span>
  <span class="token punctuation">}</span>

  <span class="token function">render</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token operator">&lt;</span>Menu ref<span class="token operator">=</span><span class="token string">&quot;menu&quot;</span> onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>onClick<span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token function">getItems</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>Menu<span class="token operator">&gt;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">componentDidMount</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>menuElm <span class="token operator">=</span> ReactDOM<span class="token punctuation">.</span><span class="token function">findDOMNode</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>refs<span class="token punctuation">.</span>menu<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>menuElm <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>outside<span class="token punctuation">)</span> <span class="token function">focusBind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>menuElm<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>outside<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">componentWillUnmount</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>menuElm <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>outside<span class="token punctuation">)</span> <span class="token function">focusUnbind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>menuElm<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>outside<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">MyDropdown</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>

  <span class="token function">constructor</span> <span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>dropdownElm <span class="token operator">=</span> <span class="token keyword">null</span>
  <span class="token punctuation">}</span>

  state <span class="token operator">=</span> <span class="token punctuation">{</span>
    visible<span class="token punctuation">:</span> <span class="token boolean">false</span>
  <span class="token punctuation">}</span>

  <span class="token function">render</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> menu <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">&lt;</span>MyMenu outside<span class="token operator">=</span><span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>handleOutside <span class="token punctuation">}</span> onClick<span class="token operator">=</span><span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>handleClick <span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>Dropdown
        ref<span class="token operator">=</span><span class="token string">&quot;divRef&quot;</span>
        visible<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>visible<span class="token punctuation">}</span>
        trigger<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">[</span><span class="token string">'click'</span><span class="token punctuation">]</span><span class="token punctuation">}</span>
        overlay<span class="token operator">=</span><span class="token punctuation">{</span> menu <span class="token punctuation">}</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>Button style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> marginLeft<span class="token punctuation">:</span> <span class="token number">8</span> <span class="token punctuation">}</span><span class="token punctuation">}</span> onClick<span class="token operator">=</span><span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>handleClick <span class="token punctuation">}</span><span class="token operator">&gt;</span>
          Button <span class="token operator">&lt;</span>Icon type<span class="token operator">=</span><span class="token string">&quot;down&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>Button<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>Dropdown<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">componentDidMount</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>dropdownElm <span class="token operator">=</span> ReactDOM<span class="token punctuation">.</span><span class="token function">findDOMNode</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>refs<span class="token punctuation">.</span>divRef<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>dropdownElm<span class="token punctuation">)</span> <span class="token function">focusBind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>dropdownElm<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>handleOutside<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">componentWillUnmount</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>dropdownElm<span class="token punctuation">)</span> <span class="token function">focusUnbind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>dropdownElm<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>handleOutside<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function-variable function">handleOutside</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> visible<span class="token punctuation">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function-variable function">handleClick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> visible<span class="token punctuation">:</span> <span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>visible <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>
  <span class="token operator">&lt;</span>MyDropdown<span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
  document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'container'</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
</code></pre></div><p><a href="https://codepen.io/taoxusheng/pen/KeRyXL?editors=1010" target="_blank" rel="noopener noreferrer">查看在线示例<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div></div><!----></div></div></div></div>
    <script src="/mt-blog/assets/js/9.3002f458.js" defer></script><script src="/mt-blog/assets/js/app.88e9b856.js" defer></script>
  </body>
</html>
